# YaraRec ‚Äî Sistema H√≠brido de Recomenda√ß√£o Baseado em Dados Fiscais  
## Incentivo ao Consumo Local em Supermercados de Manaus-AM  

---

## üß≠ Estrutura do Projeto

```
amazia/
‚îÇ
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ banco_dados/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conexao.py                 # Cria e gerencia a engine SQLite
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ init_db.py                 # Cria tabelas (DDL) e garante integridade inicial
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ dados/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carregador_dados.py        # L√™ CSVs validados e insere registros v√°lidos no banco
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utilitarios/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validacao_dados.py         # Fun√ß√µes de valida√ß√£o de CPF, CNPJ, CEP, datas, texto etc.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ limpeza_dados.py           # Padroniza campos e remove registros inv√°lidos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mensagens_ui.py            # Mostra mensagens de sucesso/erro no Streamlit
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ recomendador/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colaborativo.py            # (mantido) modelo de filtragem colaborativa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conteudo.py                # (mantido) modelo baseado em conte√∫do
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hibrido.py                 # (mantido) modelo h√≠brido
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metricas.py                # (mantido) m√©tricas (precision, recall, RMSE, MAE)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ main.py                        # (opcional) FastAPI para expor endpoints
‚îÇ
‚îú‚îÄ‚îÄ dados/
‚îÇ   ‚îú‚îÄ‚îÄ derivados/                     # CSVs limpos e prontos para inser√ß√£o no banco
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produtos.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categorias.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ marcas.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clientes.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supermercados.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nfs.csv
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ avaliacoes_busca.csv
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ modelos/                       # Modelos e par√¢metros de recomenda√ß√£o treinados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ melhores_parametros_svd.json
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ amazia.db                      # Banco SQLite principal (ser√° criado automaticamente)
‚îÇ
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îî‚îÄ‚îÄ streamlit_app/
‚îÇ       ‚îú‚îÄ‚îÄ main.py                    # Controla as 3 p√°ginas (Home, Dataset, Recs)
‚îÇ       ‚îú‚îÄ‚îÄ style.css                  # Estilos visuais da aplica√ß√£o
‚îÇ       ‚îî‚îÄ‚îÄ modules/
‚îÇ           ‚îú‚îÄ‚îÄ app_home.py            # P√°gina 1 ‚Äì Objetivo, autores, ferramentas
‚îÇ           ‚îú‚îÄ‚îÄ app_dataset.py         # P√°gina 2 ‚Äì Upload CSV, valida√ß√£o e inser√ß√£o no banco
‚îÇ           ‚îú‚îÄ‚îÄ app_avaliacoes_recomendacoes.py  # P√°gina 3 ‚Äì Avalia√ß√µes, Recs e M√©tricas
‚îÇ           ‚îú‚îÄ‚îÄ ui_messages.py         # Mensagens padronizadas da interface
‚îÇ           ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_validacao_dados.py        # Testes para valida√ß√µes de CPF, CNPJ, CEP, datas, etc.
‚îÇ   ‚îú‚îÄ‚îÄ test_banco_dados.py            # Testes de conex√£o e integridade das tabelas SQLite
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ CHECKLIST.md
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .gitignore

```


---

## üß© Estrutura das P√°ginas (Streamlit / WebApp)

### **P√°gina 1 ‚Äî Home**
- [ ] Exibir t√≠tulo: ‚ÄúYaraRec: Sistema H√≠brido de Recomenda√ß√£o Baseado em Dados Fiscais‚Äù
- [ ] Descrever objetivo do projeto  
- [ ] Mostrar autores e afilia√ß√µes  
- [ ] Listar ferramentas e bibliotecas utilizadas (Python, Pandas, Scikit-Learn, Streamlit, BigQuery, Docker)  
- [ ] Exibir fluxograma simples do sistema  

---

### **P√°gina 2 ‚Äî Dataset**
- [ ] Permitir upload em lote de arquivos `.csv`
- [ ] Importar tabelas: `PRODUTOS`, `CLIENTES`, `NFS`, `AVALIACOES_BUSCA`
- [ ] Validar e limpar dados conforme regras abaixo  
- [ ] Exibir amostra dos dados (preview 10 linhas)  
- [ ] Mostrar alertas de inconsist√™ncias detectadas  
- [ ] Salvar dataset tratado em `/data/clean/`  

---

### **P√°gina 3 ‚Äî Avalia√ß√µes e Recomenda√ß√µes**
- [ ] Selecionar usu√°rio (CPF)  
- [ ] Exibir se√ß√µes:
  - [ ] üîπ Recomenda√ß√µes  
  - [ ] üîπ Busca personalizada (filtros por categoria, marca, supermercado)  
  - [ ] üîπ Avalia√ß√µes de produtos  
  - [ ] üîπ Acur√°cia (comparativo entre recomenda√ß√£o e hist√≥rico real)  

---

## üóÇÔ∏è Estrutura das Tabelas

### **PRODUTOS**
| Campo | Tipo | Regras |
|--------|------|--------|
| Id_Categoria | int | Deve existir em `CATEGORIA` |
| Id_Marca | int | Deve existir em `MARCA` |
| Id_Produto | int | Autogerado e √∫nico |
| Descricao_Produto | str | At√© 150 caracteres, texto livre |

### **CATEGORIA**
| Campo | Tipo | Regras |
|--------|------|--------|
| Id_Categoria | int | Autogerado e √∫nico |
| Descricao_Categoria | str | Sem n√∫meros ou caracteres especiais |

### **MARCA**
| Campo | Tipo | Regras |
|--------|------|--------|
| Id_Marca | int | Autogerado e √∫nico |
| Descricao_Marca | str | Sem n√∫meros ou caracteres especiais |

### **CLIENTES**
| Campo | Tipo | Regras |
|--------|------|--------|
| Cpf | str | V√°lido e √∫nico |
| Nome | str | Sem n√∫meros ou caracteres especiais |
| DataNasc | date | Formato DD/MM/AAAA |
| Genero | char | F, M ou O |
| Cep | str | V√°lido para Manaus-AM |

### **SUPERMERCADOS**
| Campo | Tipo | Regras |
|--------|------|--------|
| Id_Supermercado | str | CNPJ+CEP (chave prim√°ria) |
| Cnpj | str | V√°lido e √∫nico |
| Nome | str | Nome da loja |
| Cep | str | V√°lido para Manaus-AM |
| Bairro | str | Texto simples |
| Rua | str | Texto simples |
| Num | str/int | Endere√ßo f√≠sico |

### **NFS**
| Campo | Tipo | Regras |
|--------|------|--------|
| Id_Supermercado | str | Deve existir em `SUPERMERCADOS` |
| Id_Produto | int | Deve existir em `PRODUTOS` |
| Preco | float | Valor positivo |
| TimeStamp_Registro | datetime | Data e hora da compra |

### **AVALIACOES_BUSCA**
| Campo | Tipo | Regras |
|--------|------|--------|
| Cpf_Cliente | str | Deve existir em `CLIENTES` |
| Id_Categoria | int | Avalia√ß√£o 0‚Äì5 ou None |
| Qtd_Busca_Categoria | int | ‚â• 0 |
| Id_Marca | int | Avalia√ß√£o 0‚Äì5 ou None |
| Qtd_Busca_Marca | int | ‚â• 0 |
| Id_Produto | int | Avalia√ß√£o 0‚Äì5 ou None |
| Qtd_Busca_Produto | int | ‚â• 0 |
| Cnpj_Supermercado | str | Deve existir em `SUPERMERCADOS` |
| Avaliacao_Supermercado | int | 0‚Äì5 ou None |
| Qtd_Busca_Supermercado | int | ‚â• 0 |

---

## üßº Fun√ß√µes de Valida√ß√£o e Limpeza

### üîπ `validate_produtos(df_produtos)`
- Verifica se `Id_Categoria` e `Id_Marca` existem  
- Gera `Id_Produto` √∫nico  
- Limita `Descricao_Produto` a 150 caracteres  

### üîπ `validate_categoria(df_categoria)`
- Remove caracteres num√©ricos e especiais  
- Gera `Id_Categoria` √∫nico  

### üîπ `validate_marca(df_marca)`
- Remove caracteres num√©ricos e especiais  
- Gera `Id_Marca` √∫nico  

### üîπ `validate_clientes(df_clientes)`
- Valida CPF, data, g√™nero e CEP  
- Remove nomes com caracteres inv√°lidos  
- Garante unicidade de CPF  

### üîπ `validate_supermercados(df_super)`
- Valida CNPJ e CEP (somente Manaus-AM)  
- Cria chave prim√°ria combinada `Id_Supermercado = CNPJ + CEP`  

### üîπ `validate_nfs(df_nfs)`
- Verifica integridade referencial (`Id_Produto`, `Id_Supermercado`)  
- Valida pre√ßo e timestamp  

### üîπ `validate_avaliacoes_busca(df_av)`
- Garante notas entre 0 e 5  
- Preenche None com 0 ou m√©dia ponderada  
- Verifica exist√™ncia de CPF e chaves externas  

---

## ü§ñ Intelig√™ncia de Recomenda√ß√£o (M√≥dulo `recommender_engine.py`)

### üî∏ Base inicial
- [ ] Utilizar dados de `AVALIACOES_BUSCA` como vetor de prefer√™ncias  
- [ ] Considerar **avalia√ß√µes expl√≠citas (0‚Äì5)** e **frequ√™ncia de busca (interesse impl√≠cito)**  
- [ ] Normalizar colunas para pesos equilibrados  

### üî∏ Modelo h√≠brido proposto
- [ ] **Filtragem colaborativa:** similaridade entre usu√°rios (cosine similarity, KNN ou LightFM)  
- [ ] **Baseado em conte√∫do:** caracter√≠sticas do produto (categoria, marca, pre√ßo m√©dio)  
- [ ] **Recomenda√ß√£o final:** m√©dia ponderada entre ambos  

### üî∏ Estrat√©gias contra *cold start*
- [ ] Produtos mais comprados (via `NFS`)  
- [ ] Itens mais buscados globalmente  
- [ ] Categorias populares na mesma regi√£o (via CEP)  

### üî∏ Ajustes de peso (exemplo)
| Fator | Peso sugerido |
|--------|----------------|
| Avalia√ß√£o expl√≠cita | 0.6 |
| Qtd_Busca | 0.3 |
| Popularidade (NFS) | 0.1 |

### üî∏ M√©tricas de avalia√ß√£o
- [ ] Precision@K  
- [ ] Recall@K  
- [ ] RMSE / MAE  
- [ ] F1-score opcional  

---

## üß™ Testes e Valida√ß√£o
- [ ] Testes unit√°rios para fun√ß√µes de valida√ß√£o  
- [ ] Teste de integridade entre tabelas (chaves cruzadas)  
- [ ] Teste de desempenho do modelo de recomenda√ß√£o  
- [ ] Verifica√ß√£o de acur√°cia geral (>80% de precis√£o m√≠nima esperada)  

---

## ‚öôÔ∏è Ferramentas e Stack T√©cnica

| Categoria | Ferramentas |
|------------|-------------|
| Linguagem | Python 3.12 |
| WebApp/UI | Streamlit |
| Dados | Pandas, BigQuery, CSV |
| IA / ML | Scikit-Learn, LightFM |
| Banco Local | SQLite ou BigQuery |
| Container | Docker |
| Controle de Vers√£o | Git + GitHub/GitLab |
| Formata√ß√£o / Lint | Black, Ruff, Pylint |

---

## üöÄ Pr√≥ximos Passos

- [ ] Implementar fun√ß√µes de valida√ß√£o e limpeza (`data_validation.py`)  
- [ ] Criar fluxo de upload e preview na P√°gina 2  
- [ ] Conectar a base limpa ao m√≥dulo de recomenda√ß√£o  
- [ ] Ajustar pesos e testar diferentes m√©tricas de avalia√ß√£o  
- [ ] Gerar relat√≥rio de desempenho (acur√°cia, precision@k, recall@k)  
- [ ] Documentar resultados e preparar artigo t√©cnico  

---

üìù **Autor(es):**  
Juliana B. Lima, Lucas C. dos Santos, Osvaldo T. Viana Junior  
**Institui√ß√£o:** Escola Superior de Tecnologia ‚Äì Universidade do Estado do Amazonas (UEA)  
**Projeto:** *YaraRec ‚Äì Sistema H√≠brido de Recomenda√ß√£o Baseado em Dados Fiscais*  
